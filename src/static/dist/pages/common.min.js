function globalFetch(e,t){return fetch(e,t).then(e=>{if(e.ok)return e.headers.get("Content-Type")?.includes("application/json")?e.json():e.text().then(e=>{throw new Error("Expected JSON but received text")});throw handleErrors(e),new Error("HTTP error, status = "+e.status)}).catch(e=>{throw e})}function handleErrors(e){429===e.status&&(localStorage.setItem("rateLimitedUntil",Date.now()+6e4),showRateLimitModal(),document.getElementById("rateLimitModal").classList.remove("hidden"),setTimeout(()=>{document.getElementById("rateLimitModal").classList.add("hidden")},6e4))}function showRateLimitModal(){const e=document.getElementById("rateLimitModal"),t=document.getElementById("countdown");let n=parseInt(localStorage.getItem("rateLimitedUntil"),10),o=n?Math.round((n-Date.now())/1e3):60;(isNaN(o)||o<=0)&&(o=60,localStorage.setItem("rateLimitedUntil",Date.now()+1e3*o)),t.textContent=o,e.classList.remove("hidden");const a=setInterval(()=>{o=Math.max(0,Math.round((n-Date.now())/1e3)),(t.textContent=o)<=0&&(clearInterval(a),e.classList.add("hidden"),localStorage.removeItem("rateLimitedUntil"))},1e3)}function adjustFooterPosition(){var e=document.querySelector("footer");document.body.offsetHeight<=window.innerHeight?e.classList.add("mt-auto"):e.classList.remove("mt-auto")}function initializeThemeToggle(){const t=document.getElementById("themeToggle"),n=document.createElement("img"),o=e=>{n.src=e?"static/images/sunrise.svg":"static/images/sunset.svg",n.style.filter=e?"invert(100%)":"none",t.contains(n)||t.appendChild(n)};var e=localStorage.getItem("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,e="dark"===e||!e&&a;document.documentElement.classList.toggle("dark",e),o(e),t.addEventListener("click",()=>{var e=document.documentElement.classList.toggle("dark");localStorage.setItem("theme",e?"dark":"light"),o(e),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{isDarkMode:e}}))})}function initializeScrollToTop(){const t=document.getElementById("backToTopBtn");t&&(window.addEventListener("scroll",()=>{var e=window.innerWidth<768?300:200;t.classList.toggle("hidden",window.scrollY<=e)}),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function toggleRegistrationModal(){document.getElementById("registrationModal").classList.toggle("hidden")}function toggleSignInModal(){document.getElementById("signInModal").classList.toggle("hidden")}function closeModal(e){e.target.closest(".modal").classList.add("hidden")}function backgroundClickToClose(e,t){e.target===t&&t.classList.add("hidden")}function initializeModalToggle(){var e=document.getElementById("registerBtn"),t=document.getElementById("signInBtn"),n=document.getElementById("registrationModal"),o=document.getElementById("signInModal");e.addEventListener("click",toggleRegistrationModal),t.addEventListener("click",toggleSignInModal),document.querySelectorAll(".close-modal").forEach(e=>{e.addEventListener("click",closeModal)}),[n,o].forEach(t=>{t.addEventListener("click",e=>backgroundClickToClose(e,t))})}function initializeFormSubmissions(){document.getElementById("registrationForm").addEventListener("submit",handleRegistrationSubmit),document.getElementById("signInForm").addEventListener("submit",handleSignInSubmit)}function handleRegistrationSubmit(e){e.preventDefault();var e=new FormData(e.target),t=e.get("email"),n=e.get("password"),o=e.get("confirm_password"),t=(resetErrorMessages(),validateField(t,"emailError","Please enter a valid email address.",validateEmail)),a=validateField(n,"passwordError","Password must be at least 8 characters long, include at least one number, one uppercase letter, and one special character.",validatePassword),n=validateFieldMatch(n,o,"confirmPasswordError","Passwords do not match.");t&&a&&n&&submitForm("/register",e)}function validateField(e,t,n,o){return!!o(e)||(showError(t,n),!1)}function validateFieldMatch(e,t,n,o){return e===t||(showError(n,o),!1)}function showError(e,t){e=document.getElementById(e);e.textContent=t,e.classList.remove("hidden")}function resetErrorMessages(){document.querySelectorAll(".error-message").forEach(e=>{e.classList.add("hidden")})}function validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function validatePassword(e){return/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*\W).{8,}$/.test(e)}function initializePasswordValidation(){const n=document.getElementById("registrationPassword"),a=document.getElementById("confirmRegistrationPassword");function t(){var e=n.value,t=a.value;const o={minLength:8<=e.length,number:/\d/.test(e),uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),specialChar:/[!@#$%^&*(),.?":{}|<>]/.test(e),passwordMatch:8<=e.length&&e===t};document.querySelectorAll(".password-requirement").forEach(e=>{var t=e.getAttribute("data-criteria"),t=o[t],n=(e.classList.toggle("text-red-500",!t),e.classList.toggle("text-green-500",t),e.querySelector(".indicator"));n?n.textContent=t?"✓":"X":((n=document.createElement("span")).className="indicator",n.textContent=t?"✓":"X",e.prepend(n))})}n&&a&&[n,a].forEach(e=>{e.addEventListener("input",t)})}function resetPasswordCriteriaIndicators(){document.querySelectorAll(".password-requirement").forEach(e=>{e.classList.add("text-red-500"),e.classList.remove("text-green-500"),e.textContent=e.textContent.replace("✓","X")})}function passwordVisibilityToggle(e,t,n){let o=document.getElementById(e),a=t?document.getElementById(t):null,s=document.getElementById(n);function i(e){e?(o.type="text",s.textContent="Hide",a&&(a.type="text")):(o.type="password",s.textContent="Show",a&&(a.type="password"))}s.addEventListener("mousedown",()=>i(!0)),s.addEventListener("mouseup",()=>i(!1)),s.addEventListener("mouseleave",()=>i(!1)),s.addEventListener("touchstart",()=>i(!0)),s.addEventListener("touchend",()=>i(!1))}function submitForm(t,e){globalFetch(t,{method:"POST",body:e}).then(e=>{e.success?(resetUIAndListeners(),showToast("Registration successful!","success"),"/login"===t&&(localStorage.setItem("loggedIn","true"),checkLoginStateAndUpdateUI())):showToast("Registration failed: Email already in use.","error")}).catch(e=>{showToast("An error occurred during registration. Please try again.","error")})}function handleSignInSubmit(e){e.preventDefault();e=new FormData(e.target);submitForm("/login",e)}function submitForm(t,e){globalFetch(t,{method:"POST",body:e}).then(e=>{e.success?(clearLoginForm(),adjustUIForLoggedOutState(),"/login"===t&&(localStorage.setItem("loggedIn","true"),checkLoginStateAndUpdateUI(),executeCurrentPageAction(),window.dispatchEvent(new CustomEvent("userLoggedIn")),showToast("Logged in","success")),"/register"===t&&(showToast("User registered","success"),resetPasswordCriteriaIndicators())):"/login"===t&&showToast(e.errorMessage||"Login failed. Wrong email or password. Please try again.","error")}).catch(e=>{showToast("An error occurred. Please try again.","error")})}function logoutUser(){globalFetch("/logout",{method:"POST"}).then(e=>{e.success&&(localStorage.removeItem("loggedIn"),clearLoginForm(),resetUIAndListeners(),clearSensitiveSessionData(),executeCurrentPageAction(),window.dispatchEvent(new CustomEvent("userLoggedOut")),showToast("Logged out","success"))}).catch(e=>{})}function safelyUpdateDisplay(e,t){e=document.getElementById(e);e&&(e.style.display=t)}function checkLoginStateAndUpdateUI(){globalFetch("/session_check").then(e=>{e.logged_in?(safelyUpdateDisplay("registrationModal","none"),safelyUpdateDisplay("signInModal","none"),safelyUpdateDisplay("signInBtn","none"),safelyUpdateDisplay("registerBtn","none"),safelyUpdateDisplay("logoutButton","block")):(safelyUpdateDisplay("registrationModal","none"),safelyUpdateDisplay("signInModal","none"),safelyUpdateDisplay("signInBtn","block"),safelyUpdateDisplay("registerBtn","block"),safelyUpdateDisplay("logoutButton","none"))}).catch(e=>{})}function conditionalCheckLoginState(){("true"===localStorage.getItem("loggedIn")?checkLoginStateAndUpdateUI:adjustUIForLoggedOutState)()}function adjustUIForLoggedOutState(){var e=document.getElementById("registrationModal"),t=document.getElementById("signInModal");e&&(e.style.display="",e.classList.add("hidden")),t&&(t.style.display="",t.classList.add("hidden")),safelyUpdateDisplay("signInBtn","block"),safelyUpdateDisplay("registerBtn","block"),safelyUpdateDisplay("logoutButton","none")}function resetUIAndListeners(){adjustUIForLoggedOutState(),initializeModalToggle(),initializeFormSubmissions()}function clearSensitiveSessionData(){sessionStorage.removeItem("userSessionInfo")}function clearLoginForm(){document.getElementById("registrationForm").reset(),document.getElementById("signInForm").reset()}function showToast(e,t="success"){const n=document.getElementById("toast-container"),o=document.createElement("div");o.className=("success"===t?"bg-blue-500":"bg-red-500")+" text-white px-4 py-2 rounded shadow-lg mb-2 toast-transition",o.textContent=e,n.appendChild(o),setTimeout(()=>{o.classList.add("opacity-0"),setTimeout(()=>{n.removeChild(o)},1e3)},2500)}document.addEventListener("DOMContentLoaded",function(){executeCurrentPageAction(),initializeModalToggle(),initializeFormSubmissions(),adjustFooterPosition(),initializeThemeToggle(),conditionalCheckLoginState(),initializeScrollToTop(),initializePasswordValidation()}),window.addEventListener("resize",adjustFooterPosition),document.addEventListener("DOMContentLoaded",()=>{var e=parseInt(localStorage.getItem("rateLimitedUntil"),10),e=e?Math.max(0,Math.round((e-Date.now())/1e3)):0;0<e&&showRateLimitModal(e)}),document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("registrationForm");e&&e.addEventListener("submit",handleRegistrationSubmit)});const pageActions={"/":()=>{"function"==typeof window.updateDynamicContent&&window.updateDynamicContent()},"/tips":()=>{"function"==typeof window.loadTipsContent&&window.loadTipsContent()}};function executeCurrentPageAction(){var e=window.location.pathname,e=pageActions[e];e&&e()}function debugSession(){fetch("/debug_session").then(e=>e.json()).then(e=>{}).catch(e=>{})}
//# sourceMappingURL=common.min.js.map